import os
from time import sleep

#Procura o externip configurado no sip.conf
ip_sip_antigo = os.popen('cat /etc/asterisk/sip.conf | grep externip').read().strip().split('\n')
for i in ip_sip_antigo:
    if ';' not in i:
        ip_sip_antigo=i
        ip_sip=i.split('=')
        ip_sip=ip_sip[1].strip()
        
#verifica o ip externo do servidor
ip_externo = os.popen('curl ifconfig.me').read().strip()

#muda o externip caso esteja diferente do ip externo pego com o curl
if ip_sip != ip_externo:
    os.system(f'sed -i \'s/{ip_sip_antigo}/externip={ip_externo}/\' /etc/asterisk/sip.conf')
    sleep(2)
    os.system('asteris -rx \'sip reload\'')
